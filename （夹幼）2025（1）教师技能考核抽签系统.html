<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>教师技能考核抽签系统</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            width: 100%;
            max-width: 500px;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
            padding: 30px;
            position: relative;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #6a11cb;
        }
        
        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 24px;
        }
        
        .header p {
            color: #7f8c8d;
            font-size: 14px;
        }
        
        .admin-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 8px 16px;
            background: linear-gradient(135deg, #8e44ad 0%, #3498db 100%);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .admin-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }
        
        .form-section {
            margin-bottom: 25px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
            font-size: 15px;
        }
        
        .skill-select {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .skill-option {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background-color: white;
            font-size: 16px;
            font-weight: 500;
            color: #555;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
        }
        
        .skill-option:hover {
            border-color: #6a11cb;
        }
        
        .skill-option.selected {
            border-color: #6a11cb;
            background-color: #f3e8ff;
            color: #6a11cb;
        }
        
        .skill-option .count {
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 12px;
            color: #7f8c8d;
            background-color: #f0f0f0;
            padding: 2px 6px;
            border-radius: 10px;
        }
        
        input[type="text"], input[type="password"] {
            width: 100%;
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        input[type="text"]:focus, input[type="password"]:focus {
            border-color: #6a11cb;
            outline: none;
            box-shadow: 0 0 0 3px rgba(106, 17, 203, 0.1);
        }
        
        .btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(106, 17, 203, 0.3);
        }
        
        .btn-primary:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-secondary {
            background-color: #f8f9fa;
            color: #555;
            border: 2px solid #e0e0e0;
        }
        
        .btn-secondary:hover {
            background-color: #e9ecef;
        }
        
        .result-container {
            margin-top: 30px;
            padding: 25px;
            background: linear-gradient(135deg, #f8f9ff 0%, #fdf2ff 100%);
            border-radius: 15px;
            border: 2px solid #e3e3e3;
            text-align: center;
            display: none;
        }
        
        .result-container.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .result-badge {
            font-size: 22px;
            font-weight: 700;
            color: #6a11cb;
            margin: 15px 0;
            padding: 15px;
            background-color: white;
            border-radius: 10px;
            border: 2px dashed #6a11cb;
            box-shadow: 0 4px 15px rgba(106, 17, 203, 0.1);
        }
        
        .result-info {
            color: #7f8c8d;
            font-size: 14px;
            margin-bottom: 15px;
        }
        
        .notice {
            background-color: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 12px;
            border-radius: 6px;
            margin-top: 15px;
            font-size: 14px;
            color: #e65100;
            text-align: left;
        }
        
        .teacher-list {
            margin-top: 15px;
            font-size: 14px;
            color: #666;
            text-align: left;
        }
        
        .teacher-list ul {
            list-style-type: none;
            padding-left: 0;
            margin-top: 5px;
        }
        
        .teacher-list li {
            padding: 6px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
        }
        
        .teacher-list li:last-child {
            border-bottom: none;
        }
        
        .error-message {
            color: #d32f2f;
            font-size: 14px;
            margin-top: 8px;
            display: none;
        }
        
        .error-message.show {
            display: block;
            animation: shake 0.5s ease;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 8px;
            font-size: 14px;
            color: #666;
        }
        
        /* 管理员面板样式 */
        .admin-panel {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .admin-panel.show {
            display: flex;
            animation: fadeIn 0.3s ease;
        }
        
        .admin-content {
            background-color: white;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            border-radius: 15px;
            padding: 30px;
            overflow-y: auto;
        }
        
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #6a11cb;
        }
        
        .admin-header h2 {
            color: #2c3e50;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            color: #7f8c8d;
            cursor: pointer;
            padding: 5px;
        }
        
        .close-btn:hover {
            color: #d32f2f;
        }
        
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .results-table th {
            background-color: #6a11cb;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }
        
        .results-table td {
            padding: 12px;
            border-bottom: 1px solid #eee;
        }
        
        .results-table tr:hover {
            background-color: #f5f5f5;
        }
        
        .skill-group {
            margin-bottom: 30px;
        }
        
        .skill-group h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            padding-left: 10px;
            border-left: 4px solid #6a11cb;
        }
        
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-card h4 {
            font-size: 14px;
            margin-bottom: 5px;
            opacity: 0.9;
        }
        
        .stat-card p {
            font-size: 24px;
            font-weight: 700;
        }
        
        .export-btn {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
        }
        
        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3);
        }
        
        .reset-btn {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 20px;
            margin-left: 15px;
            transition: all 0.3s ease;
        }
        
        .reset-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
        }
        
        .admin-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 900;
            justify-content: center;
            align-items: center;
        }
        
        .modal-overlay.show {
            display: flex;
        }
        
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 400px;
        }
        
        .modal-content h3 {
            margin-bottom: 20px;
            color: #2c3e50;
        }
        
        .confirm-modal {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 400px;
            text-align: center;
        }
        
        .confirm-modal h3 {
            color: #e74c3c;
            margin-bottom: 15px;
        }
        
        .confirm-modal p {
            margin-bottom: 25px;
            color: #555;
        }
        
        .confirm-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        .confirm-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 100px;
        }
        
        .confirm-yes {
            background-color: #e74c3c;
            color: white;
        }
        
        .confirm-yes:hover {
            background-color: #c0392b;
        }
        
        .confirm-no {
            background-color: #f8f9fa;
            color: #555;
            border: 1px solid #ddd;
        }
        
        .confirm-no:hover {
            background-color: #e9ecef;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 管理员按钮 -->
        <button class="admin-btn" id="adminBtn">管理员查看</button>
        
        <div class="header">
            <h1>教师技能考核抽签系统</h1>
            <p>湖州市夹山漾幼儿园 2025学年第一学期</p>
        </div>
        
        <div class="status-bar">
            <div>总人数: <span id="totalTeachers">37</span></div>
            <div>已抽签: <span id="drawnCount">0</span></div>
            <div>剩余: <span id="remainingCount">37</span></div>
        </div>
        
        <div class="form-section">
            <div class="form-group">
                <label>1. 选择考核项目</label>
                <div class="skill-select">
                    <div class="skill-option" data-skill="弹唱">
                        弹唱考核
                        <span class="count" id="弹唱-count">9人</span>
                    </div>
                    <div class="skill-option" data-skill="绘画">
                        绘画考核
                        <span class="count" id="绘画-count">9人</span>
                    </div>
                    <div class="skill-option" data-skill="故事">
                        故事考核
                        <span class="count" id="故事-count">15人</span>
                    </div>
                    <div class="skill-option" data-skill="舞蹈">
                        舞蹈考核
                        <span class="count" id="舞蹈-count">4人</span>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="teacherName">2. 请输入您的姓名</label>
                <input type="text" id="teacherName" placeholder="请输入您的全名">
                <div class="error-message" id="nameError">您输入的姓名不在本考核组中，请确认后重新输入</div>
            </div>
            
            <button class="btn btn-primary" id="drawBtn" disabled>开始抽签</button>
        </div>
        
        <div class="result-container" id="resultContainer">
            <div class="result-info">您的抽签结果为：</div>
            <div class="result-badge" id="resultText"></div>
            <div class="notice">
                <strong>温馨提示：</strong>
                <p>1. 请牢记您的抽签序号，考核时将按此顺序进行</p>
                <p>2. 每位老师只能抽签一次，请勿重复操作</p>
                <p>3. 考核时间将另行通知，请关注园内通知</p>
            </div>
            
            <div class="teacher-list" id="teacherList">
                <!-- 已抽签的老师名单将在这里显示 -->
            </div>
        </div>
    </div>

    <!-- 管理员登录弹窗 -->
    <div class="modal-overlay" id="loginModal">
        <div class="modal-content">
            <h3>管理员登录</h3>
            <input type="password" id="adminPassword" placeholder="请输入管理员密码" style="width:100%;">
            <div class="error-message" id="passwordError" style="margin-top:10px;">密码错误，请重新输入</div>
            <button class="btn btn-primary" id="loginBtn" style="margin-top:20px;">登录</button>
        </div>
    </div>

    <!-- 确认重置弹窗 -->
    <div class="modal-overlay" id="confirmModal">
        <div class="confirm-modal">
            <h3>⚠️ 警告：确认重置所有数据</h3>
            <p>此操作将清除所有老师的抽签记录，包括已分配的序号和抽签结果。此操作不可撤销！</p>
            <p>确定要继续吗？</p>
            <div class="confirm-buttons">
                <button class="confirm-btn confirm-yes" id="confirmResetBtn">确认重置</button>
                <button class="confirm-btn confirm-no" id="cancelResetBtn">取消</button>
            </div>
        </div>
    </div>

    <!-- 管理员面板 -->
    <div class="admin-panel" id="adminPanel">
        <div class="admin-content">
            <div class="admin-header">
                <h2>全体教师抽签结果</h2>
                <button class="close-btn" id="closeAdminBtn">×</button>
            </div>
            
            <!-- 统计信息 -->
            <div class="summary-stats">
                <div class="stat-card">
                    <h4>弹唱考核</h4>
                    <p id="adminSingCount">0/9</p>
                </div>
                <div class="stat-card">
                    <h4>绘画考核</h4>
                    <p id="adminDrawCount">0/9</p>
                </div>
                <div class="stat-card">
                    <h4>故事考核</h4>
                    <p id="adminStoryCount">0/15</p>
                </div>
                <div class="stat-card">
                    <h4>舞蹈考核</h4>
                    <p id="adminDanceCount">0/4</p>
                </div>
            </div>
            
            <!-- 各考核组详细结果 -->
            <div id="adminResults">
                <!-- 各考核组的结果会动态生成 -->
            </div>
            
            <div class="admin-buttons">
                <button class="export-btn" id="exportBtn">导出为Excel</button>
                <button class="reset-btn" id="resetBtn">重置所有数据</button>
            </div>
        </div>
    </div>

    <script>
        // 教师数据 - 修正人数统计
        const teachers = [
            { id: 1, name: '谈鑫婷', skill: '弹唱' },
            { id: 2, name: '邵晴', skill: '绘画' },
            { id: 3, name: '刘静', skill: '弹唱' },
            { id: 4, name: '邱敏', skill: '绘画' },
            { id: 5, name: '吴佳媚', skill: '舞蹈' },
            { id: 6, name: '赵洁', skill: '弹唱' },
            { id: 7, name: '陈丁霞', skill: '弹唱' },
            { id: 8, name: '叶丹', skill: '故事' },
            { id: 9, name: '李淑云', skill: '弹唱' },
            { id: 10, name: '庞丽萍', skill: '绘画' },
            { id: 11, name: '管怡婷', skill: '绘画' },
            { id: 12, name: '朱雯雯', skill: '故事' },
            { id: 13, name: '丁璐', skill: '绘画' },
            { id: 14, name: '杨佩佩', skill: '弹唱' },
            { id: 15, name: '富钰媛', skill: '绘画' },
            { id: 16, name: '张佳樱', skill: '绘画' },
            { id: 17, name: '宗嘉怡', skill: '弹唱' },
            { id: 18, name: '沈轶欣', skill: '故事' },
            { id: 19, name: '张佳玮', skill: '绘画' },
            { id: 20, name: '王艳', skill: '弹唱' },
            { id: 21, name: '罗佳音', skill: '绘画' },
            { id: 22, name: '朱雅萍', skill: '故事' },
            { id: 23, name: '汪贞', skill: '故事' },
            { id: 24, name: '翁敏', skill: '故事' },
            { id: 25, name: '何维维', skill: '故事' },
            { id: 26, name: '潘月琴', skill: '故事' },
            { id: 27, name: '吴娴贤', skill: '故事' },
            { id: 28, name: '沈琳琳', skill: '故事' },
            { id: 29, name: '翟佳军', skill: '故事' },
            { id: 30, name: '朱烨', skill: '弹唱' },
            { id: 31, name: '沈月芳', skill: '故事' },
            { id: 32, name: '许姣', skill: '故事' },
            { id: 33, name: '徐欢欢', skill: '舞蹈' },
            { id: 34, name: '陆静云', skill: '舞蹈' },
            { id: 35, name: '王凯', skill: '舞蹈' },
            { id: 36, name: '董淑阳', skill: '故事' },
            { id: 37, name: '吴佳敏', skill: '故事' }
        ];

        // 修正后的各项目人数统计
        const skillCounts = {
            '弹唱': 9,
            '绘画': 9,
            '故事': 15,
            '舞蹈': 4
        };

        // 存储抽签结果
        let drawResults = {
            '弹唱': {},  // { '谈鑫婷': 1, '刘静': 2, ... }
            '绘画': {},
            '故事': {},
            '舞蹈': {}
        };

        // 存储每个考核项目已分配的序号
        let allocatedNumbers = {
            '弹唱': [],
            '绘画': [],
            '故事': [],
            '舞蹈': []
        };

        // 管理员密码（可以修改）
        const ADMIN_PASSWORD = "123456";

        // 从本地存储加载已有结果
        function loadResults() {
            const saved = localStorage.getItem('teacher_draw_results');
            if (saved) {
                drawResults = JSON.parse(saved);
            }
            
            // 重新计算已分配的序号
            for (const skill in drawResults) {
                allocatedNumbers[skill] = Object.values(drawResults[skill]);
            }
        }

        // 保存结果到本地存储
        function saveResults() {
            localStorage.setItem('teacher_draw_results', JSON.stringify(drawResults));
        }

        // 重置所有数据
        function resetAllData() {
            drawResults = {
                '弹唱': {},
                '绘画': {},
                '故事': {},
                '舞蹈': {}
            };
            
            allocatedNumbers = {
                '弹唱': [],
                '绘画': [],
                '故事': [],
                '舞蹈': []
            };
            
            // 清除本地存储
            localStorage.removeItem('teacher_draw_results');
            
            // 刷新页面状态
            updateStatusBar();
            updateTeacherList('弹唱');
            
            // 关闭结果容器
            document.getElementById('resultContainer').classList.remove('show');
            
            // 清空姓名输入
            document.getElementById('teacherName').value = '';
            
            // 清除技能选择
            document.querySelectorAll('.skill-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            // 禁用抽签按钮
            document.getElementById('drawBtn').disabled = true;
            
            // 更新管理员面板
            updateAdminStats();
            displayAdminResults();
            
            // 显示成功提示
            alert('所有数据已重置成功！');
        }

        // 获取随机未分配的序号
        function getRandomAvailableNumber(skill) {
            const allNumbers = Array.from({length: skillCounts[skill]}, (_, i) => i + 1);
            const usedNumbers = allocatedNumbers[skill] || [];
            const availableNumbers = allNumbers.filter(num => !usedNumbers.includes(num));
            
            if (availableNumbers.length === 0) {
                return null; // 所有序号都已分配
            }
            
            // 随机选择一个可用序号
            const randomIndex = Math.floor(Math.random() * availableNumbers.length);
            return availableNumbers[randomIndex];
        }

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 加载已有结果
            loadResults();
            
            // 更新人数显示
            for (const skill in skillCounts) {
                document.getElementById(`${skill}-count`).textContent = `${skillCounts[skill]}人`;
            }
            
            // 更新状态栏
            updateStatusBar();
            
            // 技能选择
            const skillOptions = document.querySelectorAll('.skill-option');
            let selectedSkill = null;
            
            skillOptions.forEach(option => {
                option.addEventListener('click', function() {
                    // 清除所有选择
                    skillOptions.forEach(opt => opt.classList.remove('selected'));
                    // 选中当前
                    this.classList.add('selected');
                    selectedSkill = this.dataset.skill;
                    
                    // 验证姓名输入
                    validateTeacherName();
                });
            });
            
            // 姓名输入验证
            document.getElementById('teacherName').addEventListener('input', function() {
                validateTeacherName();
            });
            
            // 验证教师姓名
            function validateTeacherName() {
                const nameInput = document.getElementById('teacherName');
                const name = nameInput.value.trim();
                const errorElement = document.getElementById('nameError');
                const drawBtn = document.getElementById('drawBtn');
                
                // 清除错误状态
                errorElement.classList.remove('show');
                
                if (!selectedSkill || !name) {
                    drawBtn.disabled = true;
                    return false;
                }
                
                // 检查该老师是否在所选考核组中
                const teacherInGroup = teachers.some(t => 
                    t.name === name && t.skill === selectedSkill
                );
                
                if (!teacherInGroup) {
                    errorElement.textContent = '您输入的姓名不在本考核组中，请确认后重新输入';
                    errorElement.classList.add('show');
                    drawBtn.disabled = true;
                    return false;
                }
                
                // 检查是否已抽签
                if (drawResults[selectedSkill][name]) {
                    errorElement.textContent = '该老师已抽签，不能重复抽签';
                    errorElement.classList.add('show');
                    drawBtn.disabled = true;
                    return false;
                }
                
                // 检查是否所有序号都已分配
                if (allocatedNumbers[selectedSkill].length >= skillCounts[selectedSkill]) {
                    errorElement.textContent = '该考核组所有序号已分配完毕';
                    errorElement.classList.add('show');
                    drawBtn.disabled = true;
                    return false;
                }
                
                // 验证通过
                drawBtn.disabled = false;
                return true;
            }
            
            // 抽签按钮事件
            document.getElementById('drawBtn').addEventListener('click', function() {
                const nameInput = document.getElementById('teacherName');
                const teacherName = nameInput.value.trim();
                
                if (!validateTeacherName()) {
                    return;
                }
                
                // 执行抽签
                performDraw(selectedSkill, teacherName);
            });
            
            // 执行抽签
            function performDraw(skill, teacherName) {
                // 获取随机可用的序号
                const randomNumber = getRandomAvailableNumber(skill);
                
                if (!randomNumber) {
                    alert('所有序号已分配完毕！');
                    return;
                }
                
                // 分配序号
                drawResults[skill][teacherName] = randomNumber;
                allocatedNumbers[skill].push(randomNumber);
                
                // 保存结果
                saveResults();
                
                // 显示结果
                displayResult(skill, teacherName, randomNumber);
                
                // 更新状态栏
                updateStatusBar();
                
                // 禁用抽签按钮，防止重复抽签
                document.getElementById('drawBtn').disabled = true;
            }
            
            // 显示抽签结果
            function displayResult(skill, teacherName, number) {
                const resultContainer = document.getElementById('resultContainer');
                const resultText = document.getElementById('resultText');
                
                // 显示结果
                resultText.textContent = `${skill} ${number}号`;
                
                // 显示结果容器
                resultContainer.classList.add('show');
                
                // 更新已抽签老师列表
                updateTeacherList(skill);
                
                // 滚动到结果区域
                resultContainer.scrollIntoView({ behavior: 'smooth' });
            }
            
            // 更新已抽签老师列表
            function updateTeacherList(skill) {
                const teacherList = document.getElementById('teacherList');
                const skillResults = drawResults[skill];
                const teachersInSkill = teachers.filter(t => t.skill === skill);
                
                let html = `<div>${skill}考核组（共${skillCounts[skill]}人）</div>`;
                html += '<ul>';
                
                // 按序号排序显示
                teachersInSkill.sort((a, b) => {
                    const numA = skillResults[a.name] || 0;
                    const numB = skillResults[b.name] || 0;
                    return numA - numB;
                });
                
                teachersInSkill.forEach(teacher => {
                    const number = skillResults[teacher.name];
                    const status = number ? `已抽签: ${skill} ${number}号` : '待抽签';
                    html += `<li><span>${teacher.name}</span><span>${status}</span></li>`;
                });
                
                html += '</ul>';
                teacherList.innerHTML = html;
            }
            
            // 更新状态栏
            function updateStatusBar() {
                let totalDrawn = 0;
                for (const skill in drawResults) {
                    totalDrawn += Object.keys(drawResults[skill]).length;
                }
                
                document.getElementById('drawnCount').textContent = totalDrawn;
                document.getElementById('remainingCount').textContent = teachers.length - totalDrawn;
            }
            
            // 初始显示第一个考核组的名单
            setTimeout(() => {
                updateTeacherList('弹唱');
            }, 100);
            
            // 点击考核组时更新显示该组名单
            skillOptions.forEach(option => {
                option.addEventListener('click', function() {
                    const skill = this.dataset.skill;
                    updateTeacherList(skill);
                });
            });
            
            // 管理员相关功能
            const adminBtn = document.getElementById('adminBtn');
            const loginModal = document.getElementById('loginModal');
            const adminPanel = document.getElementById('adminPanel');
            const closeAdminBtn = document.getElementById('closeAdminBtn');
            const loginBtn = document.getElementById('loginBtn');
            const adminPassword = document.getElementById('adminPassword');
            const passwordError = document.getElementById('passwordError');
            const resetBtn = document.getElementById('resetBtn');
            const confirmModal = document.getElementById('confirmModal');
            const confirmResetBtn = document.getElementById('confirmResetBtn');
            const cancelResetBtn = document.getElementById('cancelResetBtn');
            
            // 管理员按钮点击事件
            adminBtn.addEventListener('click', function() {
                loginModal.classList.add('show');
            });
            
            // 登录按钮点击事件
            loginBtn.addEventListener('click', function() {
                if (adminPassword.value === ADMIN_PASSWORD) {
                    loginModal.classList.remove('show');
                    adminPassword.value = '';
                    passwordError.classList.remove('show');
                    
                    // 显示管理员面板并加载数据
                    showAdminPanel();
                } else {
                    passwordError.classList.add('show');
                }
            });
            
            // 关闭管理员面板
            closeAdminBtn.addEventListener('click', function() {
                adminPanel.classList.remove('show');
            });
            
            // 按Enter键登录
            adminPassword.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    loginBtn.click();
                }
            });
            
            // 点击登录弹窗外部关闭弹窗
            loginModal.addEventListener('click', function(e) {
                if (e.target === loginModal) {
                    loginModal.classList.remove('show');
                    adminPassword.value = '';
                    passwordError.classList.remove('show');
                }
            });
            
            // 点击管理员面板外部关闭面板
            adminPanel.addEventListener('click', function(e) {
                if (e.target === adminPanel) {
                    adminPanel.classList.remove('show');
                }
            });
            
            // 显示管理员面板
            function showAdminPanel() {
                // 更新统计信息
                updateAdminStats();
                
                // 显示详细结果
                displayAdminResults();
                
                // 显示管理员面板
                adminPanel.classList.add('show');
            }
            
            // 更新管理员统计信息
            function updateAdminStats() {
                document.getElementById('adminSingCount').textContent = 
                    `${Object.keys(drawResults['弹唱']).length}/${skillCounts['弹唱']}`;
                document.getElementById('adminDrawCount').textContent = 
                    `${Object.keys(drawResults['绘画']).length}/${skillCounts['绘画']}`;
                document.getElementById('adminStoryCount').textContent = 
                    `${Object.keys(drawResults['故事']).length}/${skillCounts['故事']}`;
                document.getElementById('adminDanceCount').textContent = 
                    `${Object.keys(drawResults['舞蹈']).length}/${skillCounts['舞蹈']}`;
            }
            
            // 显示管理员详细结果
            function displayAdminResults() {
                const adminResults = document.getElementById('adminResults');
                let html = '';
                
                // 对每个考核项目显示结果
                const skills = ['弹唱', '绘画', '故事', '舞蹈'];
                
                skills.forEach(skill => {
                    const skillTeachers = teachers.filter(t => t.skill === skill);
                    const skillResults = drawResults[skill];
                    
                    // 按序号排序
                    const sortedTeachers = [...skillTeachers].sort((a, b) => {
                        const numA = skillResults[a.name] || skillCounts[skill] + 1;
                        const numB = skillResults[b.name] || skillCounts[skill] + 1;
                        return numA - numB;
                    });
                    
                    html += `
                    <div class="skill-group">
                        <h3>${skill}考核组（${Object.keys(skillResults).length}/${skillCounts[skill]}）</h3>
                        <table class="results-table">
                            <thead>
                                <tr>
                                    <th>序号</th>
                                    <th>姓名</th>
                                    <th>状态</th>
                                </tr>
                            </thead>
                            <tbody>
                    `;
                    
                    sortedTeachers.forEach(teacher => {
                        const number = skillResults[teacher.name];
                        const status = number ? `<span style="color:#27ae60;">已抽签 (${number}号)</span>` : '<span style="color:#e74c3c;">未抽签</span>';
                        
                        html += `
                            <tr>
                                <td>${number || '-'}</td>
                                <td>${teacher.name}</td>
                                <td>${status}</td>
                            </tr>
                        `;
                    });
                    
                    html += `
                            </tbody>
                        </table>
                    </div>
                    `;
                });
                
                adminResults.innerHTML = html;
            }
            
            // 导出为Excel
            document.getElementById('exportBtn').addEventListener('click', function() {
                exportToExcel();
            });
            
            // 重置按钮点击事件
            resetBtn.addEventListener('click', function() {
                confirmModal.classList.add('show');
            });
            
            // 确认重置按钮事件
            confirmResetBtn.addEventListener('click', function() {
                confirmModal.classList.remove('show');
                resetAllData();
            });
            
            // 取消重置按钮事件
            cancelResetBtn.addEventListener('click', function() {
                confirmModal.classList.remove('show');
            });
            
            // 点击确认弹窗外部关闭弹窗
            confirmModal.addEventListener('click', function(e) {
                if (e.target === confirmModal) {
                    confirmModal.classList.remove('show');
                }
            });
            
            // 导出到Excel
            function exportToExcel() {
                // 创建工作簿
                const wb = XLSX.utils.book_new();
                
                // 对每个考核项目创建工作表
                const skills = ['弹唱', '绘画', '故事', '舞蹈'];
                
                skills.forEach(skill => {
                    const skillTeachers = teachers.filter(t => t.skill === skill);
                    const skillResults = drawResults[skill];
                    
                    // 准备数据
                    const data = [
                        ['序号', '姓名', '抽签结果', '状态']
                    ];
                    
                    // 按序号排序
                    const sortedTeachers = [...skillTeachers].sort((a, b) => {
                        const numA = skillResults[a.name] || skillCounts[skill] + 1;
                        const numB = skillResults[b.name] || skillCounts[skill] + 1;
                        return numA - numB;
                    });
                    
                    sortedTeachers.forEach(teacher => {
                        const number = skillResults[teacher.name];
                        const result = number ? `${skill} ${number}号` : '未抽签';
                        const status = number ? '已抽签' : '未抽签';
                        data.push([teacher.id, teacher.name, result, status]);
                    });
                    
                    // 添加统计数据行
                    data.push([]);
                    data.push(['统计信息', '', '', '']);
                    data.push(['总人数', skillCounts[skill], '', '']);
                    data.push(['已抽签', Object.keys(skillResults).length, '', '']);
                    data.push(['未抽签', skillCounts[skill] - Object.keys(skillResults).length, '', '']);
                    
                    // 创建工作表
                    const ws = XLSX.utils.aoa_to_sheet(data);
                    
                    // 添加工作表到工作簿
                    XLSX.utils.book_append_sheet(wb, ws, skill);
                });
                
                // 生成Excel文件并下载
                const fileName = `湖州市夹山漾幼儿园抽签结果_${new Date().toISOString().split('T')[0]}.xlsx`;
                XLSX.writeFile(wb, fileName);
            }
        });
    </script>
    
    <!-- 引入XLSX库用于导出Excel -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</body>
</html>